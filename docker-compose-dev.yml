version: '3.9'

services:

  nginx:
    extends:
      file: ./deployments/docker/common.yml
      service: nginx
    extra_hosts:
      - "host.docker.internal:host-gateway"
    volumes:
      - ./deployments/docker/nginx/conf.d/localhost.conf:/etc/nginx/conf.d/localhost.conf:ro

  rabbitmq:
    extends:
      file: ./deployments/docker/common.yml
      service: rabbitmq

  mongo-replica-setup:
    extends:
      file: ./deployments/docker/common.yml
      service: mongo-replica-setup
    depends_on:
      mongo1:
        condition: service_healthy

  mongo1:
    extends:
      file: ./deployments/docker/common.yml
      service: mongo1

  prometheus:
    extends:
      file: ./deployments/docker/common.yml
      service: prometheus
    extra_hosts:
      - "host.docker.internal:host-gateway"
    volumes:
      - ./deployments/docker/prometheus/localhost.yml:/etc/prometheus/prometheus.yml:ro

  grafana:
    extends:
      file: ./deployments/docker/common.yml
      service: grafana

volumes:
  mongoData1:
  mongoLog1:
  mongoConfig1:
  rabbitmqData:
  grafanaStorage:


networks:
  netApplication:
    name: netApplication
  netNginx:
    name: netNginx
